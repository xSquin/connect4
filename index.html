<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connect four</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-aFq/bzH65dt+w6FI2ooMVUpc+21e0SRygnTpmBvdBgSdnuTN7QbdgL+OapgHtvPp" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/js/bootstrap.bundle.min.js" integrity="sha384-qKXV1j0HvMUeCBQ+QVp7JcfGl760yU08IQ+GpUo5hlbpg51QRiuqHAJz8+BrxE/N" crossorigin="anonymous"></script>
    <style>
        *{
            box-sizing: border-box;
        }
        body{
            background-color: rgb(23, 22, 31);
        }
        .col{
            border: 1px solid rgb(57, 52, 73);
            height: 162.8px;
        }
        .rows{
            width: 1140px;
        }
        .move{
            text-align: center;
            font-size: 30px;
            font-weight: bold;
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: center;
            color: #ffffff;
        }
        .menu {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            text-align: center;
        }

        .menu h1 {
            font-size: 36px;
            font-weight: bold;
            color: #ffffff;
            margin-bottom: 30px;
        }

        .start-game, .game-rules {
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            color: #fff;
            background-color: rgb(38, 35, 48);
            border: none;
            padding: 10px 30px;
            border-radius: 5px;
            margin-bottom: 10px;
            transition: all 0.2s ease-in-out;
        }

        .start-game:hover, .game-rules:hover {
            background-color: #a1a9b1;
            transition: background-color 0.5s ease-in-out;
        }

        .color-move{
            width: 30px;
            height: 30px;
            background-color: rgb(245, 31, 31);
            margin: 5px;
        }
        .rules{
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            padding: 20px;
            text-align: center;
        }
        .rules h1{
            font-size: 36px;
            font-weight: bold;
            color: #ffffff;
            margin-bottom: 30px;
        }
        .back-to-menu{
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            color: #fff;
            background-color: rgb(38, 35, 48);
            border: none;
            padding: 10px 30px;
            border-radius: 5px;
            margin-bottom: 10px;
            transition: all 0.2s ease-in-out;
        }
        .rules-text{
            font-weight: bold;
            color: #a1a9b1;
            margin-bottom: 30px;
        }
        .rules-text li{
            list-style-type: none;
            margin: 10px;
        }
        .back-to-menu:hover{
            background-color: #a1a9b1;
            transition: background-color 0.5s ease-in-out;
        }
        .imgs{
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: row;
        }
        .imgs img{
            width: 300px;
            height: 200px;
            margin: 50px;
        }
    </style>
</head>
<body>
    <div class="menu">
        <h1>Connect four - gra</h1>
        <div class="start-game">Start</div>
        <div class="game-rules">Zasady Gry</div>
    </div>
    <div class="rules">
        <h1>Zasady Gry</h1>
        <div class="rules-text">
            <p>Connect 4, znana również jako Czwórki, to gra strategiczna dla dwóch graczy <span style="text-decoration: underline;">polegająca na ułożeniu czterech swoich pionków w pionie, poziomie lub na ukos</span>, zanim zrobi to przeciwnik.</p>
            <ul>
                <li>1. Gracze wykonują ruchy na przemian, umieszczając swój pionek w wybranym przez siebie pionie kolumny planszy.</li>
                <li>2. Pionek przesuwa się w dół kolumny, aż osiągnie dolną krawędź planszy lub napotka na inny pionek.</li>
                <video height="400" width="600" autoplay loop muted>
                    <source src="./res/rules1.mp4" type="video/mp4">
                </video>
                <video height="400" width="600" autoplay loop muted>
                    <source src="./res/rules2.mp4" type="video/mp4">
                </video>
                <li>3. Gra kończy się remisem, gdy plansza zostanie wypełniona pionkami i żaden z graczy nie uda mu się ułożyć czterech pionków w linii.</li>
                <li>4. Pierwszy gracz, który ułoży cztery swoje pionki w linii, wygrywa grę.</li>
            </ul>
            <p>Przykładowe wygrane: </p>
            <div class="imgs">
                <img src="./res/obraz.png" alt="obraz">
                <img src="./res/obraz2.png" alt="obraz2">
                <img src="./res/obraz3.png" alt="obraz3">
            </div>
        </div>
        <div class="back-to-menu">Powrót</div>
    </div>
    <div class="game" style="display: none;">
        <div class="move">Ruch: <div class="color-move"></div></div>
        <div class="container text-center">
            <div class="row align-items">
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
            </div>
            <div class="row align-items">
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
            </div>
            <div class="row align-items">
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
            </div>
            <div class="row align-items">
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
            </div>
            <div class="row align-items">
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
            </div>
            <div class="row align-items">
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
            </div>
        </div>
    </div>
    <script src="confetti.min.js"></script>
    <script>
        let turn = 1;
        var falling = false;
        const items = document.querySelectorAll('.col');
        const game_rules = document.querySelector('.game-rules');
        const one_row = document.querySelector('.row').children;
        const color_move = document.querySelector('.color-move');
        const start_game = document.querySelector('.start-game');
        const menu = document.querySelector('.menu');
        const game = document.querySelector('.game');
        const rules = document.querySelector('.rules');
        const back_to_menu = document.querySelector('.back-to-menu');

        start_game.addEventListener("click", () => {
            menu.style.display = "none";
            game.style.display = "block";
            start();
        });

        game_rules.addEventListener("click", () => {
            menu.style.display = "none";
            rules.style.display = "flex";
        })

        back_to_menu.addEventListener("click", () => {
            location.reload();
        })

        //Prevent F12 & Prevent Ctrl+Shift+I & turn off right click & Prevent F11
        document.addEventListener('keydown', event => {
            if (event.keyCode == 123 || event.ctrlKey && event.shiftKey && event.keyCode == 73) {
                event.preventDefault();
            }
        });
        document.addEventListener('contextmenu', event => event.preventDefault());
        
        function handleClick(obj, position){
            if(falling || obj.target.style.backgroundColor != "") return;
                falling = true;
            if(turn > 0){
                animate(move_down_position(position), "rgb(245, 31, 31)")
                color_move.style.backgroundColor = "rgb(18, 73, 223)";
                turn = 0;
            } else {
                animate(move_down_position(position), "rgb(18, 73, 223)")
                color_move.style.backgroundColor = "rgb(245, 31, 31)";
                turn = 1;
            }
        }
        function start(){
            items.forEach(function element(el, position){
                el.onclick = obj => {
                    handleClick(obj, position);
                }
            })
        }
        function reset(){
            turn = 1;
            color_move.style.backgroundColor = "rgb(245, 31, 31)";
            document.querySelector(".end_display_background").remove();
            items.forEach(function element(el){
                el.style.backgroundColor = "";
            })
        }
        function move_down_position(clicked_position){
            let done = false;
            let position_higher = 0;
            let max_num = 0;
            while(clicked_position < items.length){
                if(clicked_position < items.length){
                    max_num = clicked_position;
                    clicked_position += 7;
                }
            }
            while(!done){
                if(items[max_num - position_higher].style.backgroundColor == ''){
                    return max_num - position_higher;
                }
                position_higher += 7;
            }
        }
        function animate(position, color){
            let num = 0;
            for(let i = position; i >= 0; i-=7){
                if(i >= 0){
                    num = i;
                }
            }
            items[num].style.transition = "all 0.15s ease-in-out"
            items[num].style.backgroundColor = color;
            if(check_win() != null && (items[num+7] == null || items[num+7].style.backgroundColor != '')){
                end(check_win())
            }

            if(items[num+7].style.backgroundColor != ""){
                falling = false;
            }

            setInterval(() => {
                if(position == num){
                    clearInterval();
                    return;
                }
                num += 7
                items[num].style.transition = "all 0.15s ease-in-out"
                items[num].style.backgroundColor = color;
                items[num - 7].style.transition = "all 0.15s ease-in-out"
                items[num - 7].style.backgroundColor = "";

                if(items[num+7] == null || items[num+7].style.backgroundColor != '') {
                    falling = false;
                }
                if(check_win() != null && (items[num+7] == null || items[num+7].style.backgroundColor != '')){
                    end(check_win())
                }
            }, 150);
        }
        function check_win(){
            // sprawdzenie w poziomie
            for(let rows = 0; rows < 6; rows++){
                for(let col = 0; col < 4; col++){
                    if(
                        items[rows*7+col].style.backgroundColor && 
                        items[rows*7+col].style.backgroundColor == items[rows*7+1+col].style.backgroundColor &&
                        items[rows*7+col].style.backgroundColor == items[rows*7+2+col].style.backgroundColor &&
                        items[rows*7+col].style.backgroundColor == items[rows*7+3+col].style.backgroundColor
                    ){
                        return items[rows*7+col].style.backgroundColor
                    }
                }
            }
            // sprawdzenie w pionie
            for(let rows = 0; rows < 3; rows++){
                for(let col = 0; col < 7; col++){
                    if(
                        items[(rows*7)+col].style.backgroundColor && 
                        items[(rows*7)+col].style.backgroundColor == items[(rows*7)+col+(7*1)].style.backgroundColor &&
                        items[(rows*7)+col].style.backgroundColor == items[(rows*7)+col+(7*2)].style.backgroundColor &&
                        items[(rows*7)+col].style.backgroundColor == items[(rows*7)+col+(7*3)].style.backgroundColor
                    ){
                        return items[(rows*7)+col].style.backgroundColor
                    }
                }
            }
            //sprawdzanie na skos w prawo górę
            for(let rows = 3; rows < 6; rows++){
                for(let col = 0; col < 4; col++){
                    if(
                        items[(rows*7)+col].style.backgroundColor && 
                        items[(rows*7)+col].style.backgroundColor == items[(rows*7)+col-(6*1)].style.backgroundColor &&
                        items[(rows*7)+col].style.backgroundColor == items[(rows*7)+col-(6*2)].style.backgroundColor &&
                        items[(rows*7)+col].style.backgroundColor == items[(rows*7)+col-(6*3)].style.backgroundColor
                    ){
                        return items[(rows*7)+col].style.backgroundColor
                    }
                }
            }
            //sprawdzanie na skos w lewo górę
            for(let rows = 3; rows < 6; rows++){
                for(let col = 3; col < 7; col++){
                    if(
                        items[(rows*7)+col].style.backgroundColor && 
                        items[(rows*7)+col].style.backgroundColor == items[(rows*7)+col-(8*1)].style.backgroundColor &&
                        items[(rows*7)+col].style.backgroundColor == items[(rows*7)+col-(8*2)].style.backgroundColor &&
                        items[(rows*7)+col].style.backgroundColor == items[(rows*7)+col-(8*3)].style.backgroundColor
                    ){
                        return items[(rows*7)+col].style.backgroundColor
                    }
                }
            }
            // sprawdzenie remis
            return [...items].filter(e => e.style.backgroundColor == "").length == 0 ? "remis" : null;
        }
        function end(winner) {
            const end_display_background = document.createElement("div");
            end_display_background.id = "end_display_background";
            end_display_background.style.display = "flex";
            end_display_background.style.justifyContent = "center";
            end_display_background.style.alignItems = "center";
            end_display_background.style.position = "absolute";
            end_display_background.style.width = "100%";
            end_display_background.style.height = "100%";
            end_display_background.style.top = "0";
            end_display_background.style.left = "0";
            end_display_background.style.backgroundColor = "rgba(0, 0, 0, 0.5)";
            document.body.appendChild(end_display_background);

            const end_display = document.createElement("div");
            end_display.style.display = "flex";
            end_display.style.flexDirection = "column-reverse";
            end_display.style.justifyContent = "center";
            end_display.style.alignItems = "center";
            end_display.style.width = "400px";
            end_display.style.height = "200px";
            end_display.style.backgroundColor = "white";
            end_display.style.borderRadius = "10px";
            end_display.style.zIndex = "2";
            end_display_background.appendChild(end_display);

            const buttons = document.createElement("div");
            buttons.style.display = "flex";
            buttons.style.justifyContent = "center";
            buttons.style.alignItems = "center";
            buttons.style.marginTop = "20px";
            end_display.appendChild(buttons);

            const return_to_menu = document.createElement("div");
            return_to_menu.style.display = "flex";
            return_to_menu.style.justifyContent = "center";
            return_to_menu.style.alignItems = "center";
            return_to_menu.style.width = "150px";
            return_to_menu.style.height = "50px";
            return_to_menu.style.border = "1px solid black";
            return_to_menu.innerText = "Powrót";
            return_to_menu.style.cursor = "pointer";
            return_to_menu.style.marginRight = "15px";
            return_to_menu.style.transition = "all 0.2s ease-in-out";
            return_to_menu.style.fontWeight = "bold";
            return_to_menu.addEventListener("click", () => {location.reload();})
            buttons.appendChild(return_to_menu);

            const play_again_button = document.createElement("div");
            play_again_button.style.display = "flex";
            play_again_button.style.justifyContent = "center";
            play_again_button.style.alignItems = "center";
            play_again_button.style.width = "150px";
            play_again_button.style.height = "50px";
            play_again_button.style.border = "1px solid black";
            play_again_button.innerText = "Zagraj ponownie!";
            play_again_button.style.cursor = "pointer";
            play_again_button.style.transition = "all 0.2s ease-in-out";
            play_again_button.style.fontWeight = "bold";
            play_again_button.addEventListener("click", () => {reset();})
            buttons.appendChild(play_again_button);

            const winnerText = document.createElement("h2");
            winnerText.innerHTML = `${winner == "remis" ? "<span style=\"color: gray\">Remis!</span>" : (winner == "rgb(245, 31, 31)" ? "<span style=\"color: red\">Czerwony</span>" : "<span style=\"color: blue\">Niebieski</span>") + " wygrał!"}`;
            winnerText.style.fontWeight = "bold";
            end_display.appendChild(winnerText);
            tsParticles.load("tsparticles", {
                "fullScreen": {
                    "zIndex": 1
                },
                "particles": {
                    "color": {
                    "value": [
                        "#FFFFFF",
                        "#FFd700"
                    ]
                    },
                    "move": {
                    "direction": "bottom",
                    "enable": true,
                    "outModes": {
                        "default": "out"
                    },
                    "size": true,
                    "speed": {
                        "min": 1,
                        "max": 3
                    }
                    },
                    "number": {
                    "value": 300,
                    "density": {
                        "enable": true,
                        "area": 800
                    }
                    },
                    "opacity": {
                    "value": 1,
                    "animation": {
                        "enable": false,
                        "startValue": "max",
                        "destroy": "min",
                        "speed": 0.3,
                        "sync": true
                    }
                    },
                    "rotate": {
                    "value": {
                        "min": 0,
                        "max": 360
                    },
                    "direction": "random",
                    "move": true,
                    "animation": {
                        "enable": true,
                        "speed": 60
                    }
                    },
                    "tilt": {
                    "direction": "random",
                    "enable": true,
                    "move": true,
                    "value": {
                        "min": 0,
                        "max": 360
                    },
                    "animation": {
                        "enable": true,
                        "speed": 60
                    }
                    },
                    "shape": {
                    "type": [
                        "circle",
                        "square",
                        "triangle"
                    ],
                    "options": {}
                    },
                    "size": {
                    "value": {
                        "min": 2,
                        "max": 4
                    }
                    },
                    "roll": {
                    "darken": {
                        "enable": true,
                        "value": 30
                    },
                    "enlighten": {
                        "enable": true,
                        "value": 30
                    },
                    "enable": true,
                    "speed": {
                        "min": 15,
                        "max": 25
                    }
                    },
                    "wobble": {
                    "distance": 30,
                    "enable": true,
                    "move": true,
                    "speed": {
                        "min": -15,
                        "max": 15
                    }
                    }
                }
                });
        }
    </script>
</body>
</html>
